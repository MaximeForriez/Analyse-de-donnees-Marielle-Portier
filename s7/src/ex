import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import scipy.stats

def ouvrirUnFichier(nom):
    with open(nom, "r") as fichier:
        contenu = pd.read_csv(fichier)
    return contenu

# Charger les données
data = ouvrirUnFichier("C:\Python\s7\src\data\pib-vs-energie.csv")

# Sélection des colonnes d'intérêt et suppression des valeurs manquantes
colonnes_interet = ['PIB_2022', 'Utilisation_d_energie_2022']
data_complet = data.dropna(subset=colonnes_interet)

print("Visualisation des données complètes (sans valeurs manquantes) :")
print(data_complet)

# Régression linéaire simple
x = data_complet['Utilisation_d_energie_2022']  # variable explicative
y = data_complet['PIB_2022']                    # variable à expliquer

result = scipy.stats.linregress(x, y)

print("\nRésultats de la régression linéaire :")
print(f"Pente (slope) : {result.slope}")
print(f"Ordonnée à l'origine (intercept) : {result.intercept}")
print(f"Coefficient de corrélation (r-value) : {result.rvalue}")
print(f"p-value : {result.pvalue}")
print(f"Erreur standard (stderr) : {result.stderr}")

# Calcul de la corrélation simple
correlation = np.corrcoef(x, y)[0, 1]
print(f"\nCorrélation simple entre les deux colonnes : {correlation}")

# Graphique de synthèse avec la droite de régression
plt.figure(figsize=(8, 6))
plt.scatter(x, y, color='blue', label='Données')
plt.plot(x, result.intercept + result.slope * x, color='red', label='Droite de régression')
plt.xlabel('Utilisation d\'énergie 2022')
plt.ylabel('PIB 2022')
plt.title('Régression linéaire : PIB vs Utilisation d\'énergie')
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.show()